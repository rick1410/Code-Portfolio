from dataclasses import dataclass
import numpy as np
import pandas as pd

@dataclass(frozen=True)
class DataConfig:
    csv_path: str
    date_col: str = "DATE"
    price_col: str = "SP500"
    monthly_freq: str = "M"

class DataLoader:
    """Loads daily data and converts to monthly end-of-period levels."""
    def __init__(self, config: DataConfig):
        self.config = config

    def load_monthly(self) -> pd.DataFrame:
        df = pd.read_csv(self.config.csv_path)
        df[self.config.date_col] = pd.to_datetime(df[self.config.date_col])
        df[self.config.price_col] = pd.to_numeric(df[self.config.price_col], errors="coerce")
        df = df.set_index(self.config.date_col).sort_index()
        df = df.interpolate(method="linear")

        monthly = df.resample(self.config.monthly_freq).last()
        monthly["NetReturn"] = monthly[self.config.price_col].pct_change()
        monthly["LogReturn"] = np.log(monthly[self.config.price_col]).diff()
        monthly = monthly.dropna()
        return monthly
